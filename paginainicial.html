<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ajude a Serra Gaúcha</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBaPIef727wahxfE-So5Q_4EMBUgeF7PPo&callback=initMap"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
    }
    header {
      background-color: #754CEC;
      color: white;
      padding: 2.5rem 1rem;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    .title {
      background-color: #00008b;
      display: inline-block;
      padding: 0.5rem 1rem;
      border-radius: 10px;
      font-weight: bold;
      font-size: 2rem;
    }
    .subtitle {
      font-size: 1rem;
      margin-top: 0.5rem;
    }
    .icon-button {
      width: 24px;
      height: 24px;
    }
    .top-right-buttons {
      position: absolute;
      top: 1rem;
      right: 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .top-right-buttons button {
      background: none;
      border: none;
      font-size: 0.5rem;
      cursor: pointer;
      padding: 0;
    }
    nav {
      background-color: #8d6af5;
      display: flex;
      justify-content: center;
      gap: 2rem;
      padding: 0.5rem;
    }
    nav a {
      text-decoration: none;
      color: white;
      font-weight: bold;
    }
    nav a:hover {
      text-decoration: underline;
    }
    .nav-item span {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    .nav-item img {
      width: 10px;
      height: 10px;
    }
    .container {
      display: flex;
      padding: 3rem;
    }
    .sidebar-left, .sidebar-right {
      width: 20%;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      color: #6a0dad;
    }
    .sidebar-left span,
    .sidebar-right span {
      font-weight: bold;
      color: #754CEC;
    }
    .opcao-com-seta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: #6a0dad;
      cursor: pointer;
    }
    .opcao-com-seta img {
      width: 20px;
      height: 20px;
      margin-left: 0.5rem;
    }
    .clear-button {
      background-color: #e6d8f3;
      color: #6a0dad;
      border: none;
      padding: 0.5rem;
      cursor: pointer;
      font-weight: bold;
      width: fit-content;
    }
    #map {
      flex-grow: 1;
      height: 500px;
      margin: 0 1rem;
    }
    .map-footer {
      background-color: #8d6af5;
      color: white;
      text-align: center;
      padding: 0.5rem;
      font-weight: bold;
    }
    .cinza span {
      color: #757575;
    }
  </style>
</head>
<body>
  <header>
    <div class="title"><strong><em>AJUDE <br> A SERRA GAÚCHA</em></strong></div>
    <div class="subtitle">Consulte informações sobre oportunidades <br> de voluntariado para seu caso.</div>
    <div class="top-right-buttons">
      <button><img src="imagens/search-interface-symbol.png" alt="busca" class="icon-button"></button>
      <button><img src="imagens/menu.png" alt="menu" class="icon-button"></button>
      <button><a href="cadastrovoluntarios.html" target="_self"><img src="imagens/user.png" alt="user" class="icon-button"></a></button>
      <span>Crie sua conta<br> ou faça login</span>
    </div>
  </header>

  <nav>
    <a href="#" onclick="location.reload()">Página Inicial</a>
    <a href="#" onclick="carregar('conteudos/abrigos.html')">Abrigos e Centros</a>
    <a href="#" onclick="carregar('conteudos/campanhas.html')">Campanhas</a>
    <a href="#" onclick="carregar('conteudos/voluntarios.html')">Voluntários</a>
    <a href="ocorrenciamain.html">Ocorrências</a>
    <a href="#" onclick="carregar('conteudos/desaparecidos.html')">Desaparecidos</a>
  </nav>

  <main id="conteudo">
    <div class="container">
      <div class="sidebar-left">
        <div class="cinza"><span>Filtrar por cidade</span></div>
        <div class="opcao-com-seta">
          <div class="cinza"><span>Caxias do Sul</span></div>
          <img src="imagens/arrow-down-cinza.png" alt="seta">
        </div>
        <div class="cinza"><span>Filtrar por bairro</span></div>
        <div class="opcao-com-seta">
          <div class="cinza"><span>Todos</span></div>
          <img src="imagens/arrow-down-cinza.png" alt="seta">
        </div>
        <div class="cinza"><span>Filtrar por endereço</span></div>
        <div class="opcao-com-seta">
          <div class="cinza"><span>Todos</span></div>
          <img src="imagens/arrow-down-cinza.png" alt="seta">
        </div>
        <span>Filtrar por abrigo emergencial</span>
        <div class="opcao-com-seta" id="filter-abrigo">
          <span>Todos</span>
          <img src="imagens/arrow-down-cinza.png" alt="seta">
        </div>
        <div class="cinza"><span>Filtrar por necessidade</span></div>
        <div class="opcao-com-seta">
          <div class="cinza"><span>Todos</span></div>
          <img src="imagens/arrow-down-cinza.png" alt="seta">
        </div>
        <span>Filtrar por abrigo residencial</span>
        <div class="opcao-com-seta" id="filter-tipo-abrigo">
          <span>Todos</span>
          <img src="imagens/arrow-down-cinza.png" alt="seta">
        </div>
        <button class="clear-button">Limpar filtros</button>
      </div>

      <div id="map"></div>

      <div class="sidebar-right">
        <div class="cinza"><span>Filtrar por campanha</span></div>
        <div class="opcao-com-seta">
          <div class="cinza"><span>Todas</span></div>
          <img src="imagens/arrow-down-cinza.png" alt="seta">
        </div>
        <span>Filtrar por centro de animais</span>
        <div class="opcao-com-seta" id="filter-centro-animais">
          <span>Todas</span>
          <img src="imagens/arrow-down-cinza.png" alt="seta">
        </div>
        <div class="cinza"><span>Filtrar por necessidade</span></div>
        <div class="opcao-com-seta">
          <div class="cinza"><span>Todas</span></div>
          <img src="imagens/arrow-down-cinza.png" alt="seta">
        </div>
        <div class="cinza"><span>Tipo de centro de coleta</span></div>
        <div class="opcao-com-seta">
          <div class="cinza"><span>Todas</span></div>
          <img src="imagens/arrow-down-cinza.png" alt="seta">
        </div>
        <div class="cinza"><span>Tipo de arrecadação</span></div>
        <div class="opcao-com-seta">
          <div class="cinza"><span>Todas</span></div>
          <img src="imagens/arrow-down-cinza.png" alt="seta">
        </div>
      </div>
    </div>
    <div class="map-footer">Mapa de abrigos e centros de coleta</div>
  </main>

  <script>
    let map;
let markersAbrigo = [];
let markersTipoAbrigo = [];
let markersCentroAnimais = [];

// Definir funções no escopo global para modais
window.abrirModal = function(id) {
  const modal = document.getElementById(id);
  if (modal) {
    console.log("Abrindo modal: ", id);
    modal.style.display = "flex";
  } else {
    console.error("Modal não encontrado: ", id);
  }
};

window.fecharModal = function(id) {
  const modal = document.getElementById(id);
  if (modal) {
    console.log("Fechando modal: ", id);
    modal.style.display = "none";
  } else {
    console.error("Modal não encontrado: ", id);
  }
};

window.onclick = function(event) {
  const modais = document.getElementsByClassName("modal");
  for (let i = 0; i < modais.length; i++) {
    if (event.target === modais[i]) {
      modais[i].style.display = "none";
    }
  }
};

    function initMap() {
      if (document.getElementById('map')) {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: -29.1678, lng: -51.1794}, // Centro em Caxias do Sul, RS
          zoom: 13
        });
        addFilterEvents(); // Reaplicar eventos dos filtros
      }
    }

function addMarkers(positions, markersArray, modalIds) {
  if (!map) return;
  positions.forEach((pos, index) => {
    let marker = new google.maps.Marker({
      position: pos,
      map: map,
      title: pos.title || 'Abrigo/Centro'
    });
    // Adicionar evento de clique para redirecionar para abrigos.html com o ID do modal
    if (modalIds && modalIds[index]) {
      marker.addListener('click', () => {
        window.location.href = `abrigosprox.html?id=${modalIds[index]}`;
      });
    }
    markersArray.push(marker);
  });
}

function removeMarkers(markersArray) {
  markersArray.forEach(m => m.setMap(null));
  markersArray.length = 0;
}

    function addFilterEvents() {
      const abrigo = document.getElementById('filter-abrigo');
      if (abrigo) {
        abrigo.addEventListener('click', () => {
          if (markersAbrigo.length > 0) {
            removeMarkers(markersAbrigo);
          } else {
            const positions = [
              {lat: -29.168, lng: -51.179},
              {lat: -29.160, lng: -51.170}
            ];
            addMarkers(positions, markersAbrigo);
          }
        });
      }

      const tipoAbrigo = document.getElementById('filter-tipo-abrigo');
      if (tipoAbrigo) {
        tipoAbrigo.addEventListener('click', () => {
          if (markersTipoAbrigo.length > 0) {
            removeMarkers(markersTipoAbrigo);
          } else {
            const positions = [
              {lat: -29.170, lng: -51.180},
              {lat: -29.165, lng: -51.175}
            ];
            addMarkers(positions, markersTipoAbrigo);
          }
        });
      }

      const centroAnimais = document.getElementById('filter-centro-animais');
      if (centroAnimais) {
        centroAnimais.addEventListener('click', () => {
          if (markersCentroAnimais.length > 0) {
            removeMarkers(markersCentroAnimais);
          } else {
            const positions = [
              {lat: -29.175, lng: -51.185},
              {lat: -29.155, lng: -51.165}
            ];
            addMarkers(positions, markersCentroAnimais);
          }
        });
      }

  const clearButton = document.querySelector('.clear-button');
  if (clearButton) {
    clearButton.addEventListener('click', () => {
      removeMarkers(markersAbrigo);
      removeMarkers(markersTipoAbrigo);
      removeMarkers(markersCentroAnimais);
    });
  }
}

    function carregar(pagina) {
      console.log("Carregando página: ", pagina);
      fetch(pagina)
        .then(resp => {
          if (!resp.ok) {
            throw new Error(`Erro ao carregar ${pagina}: ${resp.statusText}`);
          }
          return resp.text();
        })
        .then(html => {
          document.getElementById("conteudo").innerHTML = html;
          console.log("Conteúdo carregado com sucesso: ", pagina);
          // Reinicializar o mapa se o elemento #map estiver presente
          if (document.getElementById('map')) {
            initMap();
          }
        })
        .catch(err => {
          document.getElementById("conteudo").innerHTML = "<p>Erro ao carregar conteúdo: " + err.message + "</p>";
          console.error(err);
        });
    }

    // Inicializar o mapa ao carregar a página
    window.onload = function() {
      initMap();
    };
  </script>
</body>
</html>